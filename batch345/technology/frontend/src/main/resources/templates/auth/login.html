<div class="d-none" id="txtLoginTitle" th:text="${title}"></div>
<div id="alertLogin" class="d-none alert alert-danger" role="alert">
  A simple danger alertâ€”check it out!
</div>
<form th:action="@{~/auth/login}" id="formLogin">
  <div class="card">
    <div class="card-body d-grid gap-3">
      <div class="row">
        <div class="form-group">
          <label for="txtEmail" class="form-label">Email</label>
          <input id="txtEmail" type="email" class="form-control" name="email" />
        </div>
      </div>
      <div class="row">
        <div class="form-group">
          <label for="txtPassword" class="form-label">Password</label>
          <input
            id="txtPassword"
            type="password"
            class="form-control"
            name="password"
          />
        </div>
      </div>
      <div id="errMsg" class="alert-warning d-flex">
        <ul class="list-group list-unstyled"></ul>
      </div>
    </div>
    <div class="card-footer d-flex justify-content-between align-items-center">
      <p class="text-secondary">
        Don't have an account? <a id="registerAnchor" href="">Register here</a>
      </p>
      <button type="submit" class="btn btn-primary">Log In</button>
    </div>
  </div>
</form>

<script>
  $(document).ready((e) => {
    $("#staticModalLabel").text($("#txtLoginTitle").text());

    $("#registerAnchor").click((e) => {
      e.preventDefault();
      $("#staticModalLgBody").load("/customer/add");
      $("#staticModal").modal("hide");
      $("#staticModalLg").modal("show");
    });

    $("#formLogin").validate({
      rules: {
        email: {
          required: true,
          maxlength: 50,
          email: true,
        },
        password: {
          required: true,
          maxlength: 50,
          minlength: 6,
        },
      },
      messages: {
        email: {
          required: "Email cannot be null",
        },
        password: {
          required: "Password cannot be null",
        },
      },
      errorClass: "text-danger px-1",
      errorContainer: "#errMsg",
      errorLabelContainer: "#errMsg ul",
      wrapper: "li",
    });

    $("#formLogin").submit((e) => {
      e.preventDefault();

      if ($("#formLogin").valid()) {
        $.ajax({
          url: "/auth/login",
          type: "post",
          data: $("#formLogin").serialize(),
          dataType: "json",
          beforeSend: () => {
            // alert("Mengirim data ke API");
          },
          success: (response) => {
            if (response.name) {
              alert("Login success!, Selamat datang, " + response.name);
              location.reload();
            }
          },
          error: (errResponse) => {
            $("#alertLogin")
              .removeClass("d-none")
              .text(errResponse.responseText);
            console.log(errResponse);
            console.error("User Login Failed: " + errResponse);
          },
        });
      }
    });
  });
</script>
