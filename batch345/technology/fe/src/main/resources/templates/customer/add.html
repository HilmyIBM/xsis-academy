<span id="txtTitle" class="d-none" th:text="${title}"></span>
<div class="card p-3">
    <form id="frmNewCustomer">
        <div class="mb-3">
            <label for="txtNameCustomer" class="form-label">Nama</label>
            <input type="text" name="name" id="txtNameCustomer" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="txtEmail" class="form-label">Email</label>
            <input type="email" name="email" id="txtEmail" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="txtPassword" class="form-label">Password</label>
            <input type="text" name="password" id="txtPassword" class="form-control" required disabled
                value="ABC123!@#$">
        </div>

        <div class="mb-3">
            <label for="txtAddress" class="form-label">Address</label>
            <input type="text" name="address" id="txtAddress" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="txtPhone" class="form-label">Phone</label>
            <input type="text" name="phone" id="txtPhone" class="form-control" required>
        </div>

        <div class="mb-3 container">
            <!-- Customer Role -->
            <label class="form-label" for="customerRole">Role ID</label>
            <select class="form-control col-lg-9 col-12" name="roleId" id="customerRole">
                <option value="">--Select Role ID--</option>
                <option th:value="${1}" th:text="${'Admin'}"></option>
                <option th:value="${2}" th:text="${'Customer'}"></option>
            </select>
        </div>
        <div class="d-flex justify-content-end mt-3">
            <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i> Save
            </button>
        </div>
    </form>

    <div th:unless="${variants != null}" class="text-danger mt-3">
        <span th:value="${errMsg}"></span>
    </div>
</div>


<script>
    $(document).ready(function () {
        $("#staticModalLabel").text($("#txtTitle").text())
        $("#frmNewCustomer").validate({
            rules: {
                name: {
                    required: true,
                    minlength: 3
                },
                email: {
                    required: true,
                },
                password: {
                    required: true,
                    min: 6
                },
                address: {
                    required: true
                },
                phone: {
                    required: true,
                    min: 10,
                    Number: true
                },
                roleId: {
                    required: true,
                    min: 1
                }
            },
            messages: {
                name: {
                    required: "Name is required",
                },
                email: {
                    required: "Email is required",
                },
                password: {
                    required: "Password is required",
                    min: 6
                },
                address: {
                    required: "Address is required"
                },
                phone: {
                    required: "Phone is required",
                },
                roleId: {
                    required: "Role ID is required",
                }
            },
            "errorClass": "text-danger"
        });
        $("#frmNewCustomer").on("submit", function (e) {
            e.preventDefault();
            if ($("#frmNewCustomer").valid()) {
                console.log("Validation complete")
                $.ajax({
                    url: "customer/create",
                    type: "post",
                    data: $("#frmNewCustomer").serialize(),
                    dataType: "json",
                    beforeSend: function () {
                        alert("Creating Customer.....");
                    },
                    success: function (response) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: `Customer name ${response.name} successfully created!`,
                            confirmButtonText: 'OK'
                        }).then(() => {
                            location.reload();
                        });
                    },
                    error: function (errResponse) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: `Error creating customer: ${errResponse.responseJSON.error + " : " + errResponse.responseJSON.message}`,
                            confirmButtonText: 'OK'
                        }).then(() => {
                            location.reload()
                        });
                    }
                });
            } else {
                console.log("Form is invalid, validation failed.");
            }
        });
    });

</script>