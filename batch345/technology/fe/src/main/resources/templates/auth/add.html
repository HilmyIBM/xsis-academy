<span id="txtTitleAddCustomer" class="d-none" th:text="${title}"></span>
<div class="card p-3">
    <form id="frmNewCustomer">
        <input type="text" name="roleId" id="roleId" value="2" hidden>
        <div class="mb-3">
            <label for="txtNameCustomer" class="form-label">Nama</label>
            <input type="text" name="name" id="txtNameCustomer" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="txtEmail" class="form-label">Email</label>
            <input type="email" name="email" id="txtEmail" class="form-control" required>
        </div>

        <div class="row">
            <div class="col">
                <div class="mb-3">
                    <label for="txtPassReg" class="form-label">Password</label>
                    <input type="password" name="password" id="txtPassReg" class="form-control" required>
                </div>
            </div>
            <div class="col">
                <div class="mb-3">
                    <label for="txtConfirmPassword" class="form-label">Confirm Password</label>
                    <input type="password" name="confirmPassword" id="txtConfirmPassword" class="form-control" required>
                </div>
            </div>
        </div>
        <div class="mb-3">
            <label for="txtAddress" class="form-label">Address</label>
            <input type="text" name="address" id="txtAddress" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="txtPhone" class="form-label">Phone</label>
            <input type="text" name="phone" id="txtPhone" class="form-control" required>
        </div>
        <div class="d-flex justify-content-end mt-3">
            <button type="submit" class="btn btn-success">
                <i class="fas fa-save"></i> Save
            </button>
        </div>
    </form>

    <div th:unless="${variants != null}" class="text-danger mt-3">
        <span th:value="${errMsg}"></span>
    </div>
</div>


<script>
    $(document).ready(function () {
        $("#staticModalLabel").text($("#txtTitleAddCustomer").text())

        $("#frmNewCustomer").validate({
            rules: {
                name: {
                    required: true,
                    minlength: 3
                },
                email: {
                    required: true,
                },
                password: {
                    required: true,
                    minlength: 6
                },
                confirmPassword: {
                    required: true,
                    equalTo: "#txtPassReg"
                },
                address: {
                    required: true
                },
                phone: {
                    required: true,
                    min: 10,
                    number: true
                },
                roleId: {
                    required: true,
                    min: 1
                }
            },
            messages: {
                name: {
                    required: "Name is required",
                },
                email: {
                    required: "Email is required",
                },
                password: {
                    required: "Password is required",
                    minlength: "Minimum password is 6 character"
                },
                confirmPassword: {
                    required: "Confirm Password is Required",
                    equalTo: "Missmatch Confirm Password"
                },
                address: {
                    required: "Address is required"
                },
                phone: {
                    required: "Phone is required",
                },
                roleId: {
                    required: "Role ID is required",
                }
            },
            "errorClass": "text-danger",
            focusInvalid: false,
        });
        $("#frmNewCustomer").on("submit", function (e) {
            e.preventDefault();
            if ($("#frmNewCustomer").valid()) {
                $("#txtPassword").prop("disabled", false);
                $.ajax({
                    url: "customer/create",
                    type: "post",
                    data: $("#frmNewCustomer").serialize(),
                    dataType: "json",
                    beforeSend: function () {
                        alert("Creating Customer.....");
                    },
                    success: function (response) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: `Customer name ${response.name} successfully created!`,
                            confirmButtonText: 'OK'
                        }).then(() => {
                            location.reload();
                        });
                    },
                    error: function (errResponse) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            text: `Error creating customer: ${errResponse.responseText}`,
                            confirmButtonText: 'OK'
                        }).then(() => {
                            location.reload()
                        });
                    }
                });
            } else {
                console.log("Form is invalid, validation failed.");
            }
        });
    });

</script>