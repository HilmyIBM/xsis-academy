<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{fragments/layout}">
<head>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=h1, initial-scale=1.0">
    <title>Product List</title>
    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/2.2.1/css/dataTables.jqueryui.min.css">
    <script src="https://cdn.datatables.net/2.2.1/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.2.1/js/dataTables.jqueryui.min.js"></script> -->
</head>
<body>
    <div layout:fragment="content" class="bg-light p-3">
        <H2>Product List</H2>
        <button 
        type="button" 
        class="btn" 
        style="background-color: purple; color: white;" 
        data-bs-toggle="modal" 
        data-bs-target="#staticModal"
        id="btnAdd">Add</button>
        <div class="p-3 bg-white">
            <div class="d-flex justify-content-between mb-3 w-100">
                <div class="d-flex align-items-center gap-3">
                    <p class="m-0">show</p>
                    <div class="">
                        <select id="slsEntries" class="form-select" name="currPageSize">
                            <option value="3" th:selected="${product.size == 3}">3</option>
                            <option value="5" th:selected="${product.size == 5}">5</option>
                            <option value="10" th:selected="${product.size == 10}">10</option>
                            <option th:value="${product.totalElements}" th:selected="${product.size == product.totalElements}">Show All</option>
                        </select>
                    </div>
                    <p class="m-0">Entries</p>
                </div>
                <div class="gap-3 d-flex align-items-center">
                    <form id="formFilter">
                        <div class="input-group align-items-center">
                            <label for="search" class="me-3">Search</label>
                            <input
                                th:if="${filter!=null}"
                                name="filter"
                                type="text"
                                id="txtFilter"
                                class="form-control"
                                placeholder="Cari..."
                                th:value="${filter}"
                            />
                            <input
                                th:unless="${filter!=null}"
                                name="filter"
                                type="text"
                                id="txtFilter"
                                class="form-control"
                                placeholder="Cari..."
                            />
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="d-flex justify-content-center">
                <table class="table table-striped table-hover w-75">
                    <thead>
                        <tr class="text-center">
                            <td scope="col" >image</td>
                            <td scope="col" ><a href="" th:data-orderby="${orderId}">
                                id
                                <i th:if="${orderBy == 'id'}" class="fas fa-sort-up"></i>
                                <i th:if="${orderBy == 'id_desc'}" class="fas fa-sort-down"></i>
                            </a></td>
                            <td scope="col" ><a href="" th:data-orderby="${orderName}">nama product
                                <i th:if="${orderBy == 'name'}" class="fas fa-sort-up"></i>
                                <i th:if="${orderBy == 'name_desc'}" class="fas fa-sort-down"></i>
                            </a></td>
                            <td scope="col"><a href="" th:data-orderby="${orderCategory}">category
                                <i th:if="${orderBy == 'category'}" class="fas fa-sort-up"></i>
                                <i th:if="${orderBy == 'category_desc'}" class="fas fa-sort-down"></i>
                            </a></td>
                            <td scope="col"><a href="" th:data-orderby="${orderVariant}">variant
                                <i th:if="${orderBy == 'variant'}" class="fas fa-sort-up"></i>
                                <i th:if="${orderBy == 'variant_desc'}" class="fas fa-sort-down"></i>
                            </a></td>
                            <td scope="col"><a href="" th:data-orderby="${orderPrice}">price
                                <i th:if="${orderBy == 'price'}" class="fas fa-sort-up"></i>
                                <i th:if="${orderBy == 'price_desc'}" class="fas fa-sort-down"></i>
                            </a></td>
                            <td scope="col"><a href="" th:data-orderby="${orderStock}">stock
                                <i th:if="${orderBy == 'stock'}" class="fas fa-sort-up"></i>
                                <i th:if="${orderBy == 'stock_desc'}" class="fas fa-sort-down"></i>
                            </a></td>
                            <td scope="col">is delete</td>
                            <td scope="col">action</td>
                        </tr>
                    </thead>
                    <tbody class="" style="border-top: white;" th:if="${!product.empty}">
                      <tr th:each="item:${product.content}" class="text-center align-middle">
                            <td class="ratio ratio-1x1 text-center" style="width: 70px;">
                                <!-- <img th:src="@{'lib/images/' + ${item.image}}" th:alt="${item.name}" class="img-thumbnail rounded-circle w-75 h-75"> -->
                                <img th:if="${item.image} != null" th:src="@{'lib/images/' + ${item.image}}" class="img-thumbnail rounded-circle w-75 h-75">
                                <i th:unless="${item.image} != null" class="fas fa-image fa-2x"></i>
                            </td>
                            <td scope="row" th:text="${item.id}">id</td>
                            <td th:text="${item.name}">nama product</td>
                            <!-- <td th:text="${item.price}">category</td>  -->
                            <td scope="row" th:text="${item.categoryName}">category</td>
                            <td scope="row" th:text="${item.variantName}">variant</td>
                            <td scope="row" th:text="${item.price}">price</td>
                            <td scope="row" th:text="${item.stock}">stock</td>
                            <td scope="row" th:text="${item.deleted}">is delete</td>
                            <!-- <td th:text="${item.categoryId}"></td>-->
                            <td class="">
                                <div class="">
                                    <button th:data-id="${item.id}" type="button" title="edit" class="btn btn-success text-dark">Edit</button>
                                    <button th:data-id="${item.id}" type="button" id= "btnDelete" title="delete" class="btn btn-danger text-light">Delete</button>
                                    <button th:data-id="${item.id}" type="button" id="btnDetail" title="detail" class="btn btn-warning text-light">Detail</button>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="d-flex justify-content-end">
                <div class="btn-group">
                    <button id="btnPrev" type="button" class="btn btn-primary">Previous</button>
                    <span id="pagePosition" class="input-group-text text-end" th:text="|Page ${product.number+1} of ${product.totalPages}|"></span>
                    <button id="btnNext" type="button" class="btn btn-primary">Next</button>
                </div>
            </div>
        </div>
        <script th:inline="javascript">
            document.getElementById("slsEntries").addEventListener("change", function() {
                let filter = $("#txtFilter").val();
                let currPageSize = this.value;
                location.href = `/product?filter=${filter}&pageNumber=${0}&currPageSize=${currPageSize}`;
            });
            $(document).ready(function(e){
                let isFirstPage = /*[[${product.first}]]*/true;
                let isLastPage = /*[[${product.last}]]*/false;
                $("#btnPrev").prop("disabled", isFirstPage);
                $("#btnNext").prop("disabled", isLastPage);
            });
            $("#btnAdd").click(function(e){
                $("#staticModalBody").load("/product/add");
            });
            $(".btn-success").click(function(e){
                let varID = $(this).data("id");
                $("#staticModalBody").load("/product/edit/" + varID);
                $("#staticModal").modal("show");
            });
            $(".btn-danger").click(function(e){
                let varID = $(this).data("id");
                $("#staticModalBody").load("/product/delete/" + varID);
                $("#staticModal").modal("show");
            });
            $(".btn-warning").click(function(e){
                let varID = $(this).data("id");
                $("#staticModalBody").load("/product/" + varID);
                $("#staticModal").modal("show");
            });
            $("#btnPrev").click(function(e){
                let filter = $("#txtFilter").val();
                let currPageSize = /*[[${currPageSize}]]*/0;
                let pageNow = /*[[${product.number}]]*/0;
                location.href = `/product?filter=${filter}&pageNumber=${pageNumber-1}&currPageSize=${currPageSize}`;
            });
            $("#btnNext").click(function(e){
                let filter = $("#txtFilter").val();
                let currPageSize = /*[[${currPageSize}]]*/0;
                let pageNumber = /*[[${product.number}]]*/0;
                location.href = `/product?filter=${filter}&pageNumber=${pageNumber+1}&currPageSize=${currPageSize}`;
            });
            $("td > a").click(function(e){
                e.preventDefault();
                let filter = $("#txtFilter").val();
                let currPageSize = /*[[${currPageSize}]]*/0;
                let pageNumber = /*[[${product.number}]]*/0;
                let orderBy = $(this).data("orderby");
                location.href = `/product?filter=${filter}&pageNumber=${pageNumber}&currPageSize=${currPageSize}&orderBy=${orderBy}`
            });
        </script>
    </div>
</body>
</html>