<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{fragments/layout}">
	<head>
		<title>Product::Index</title>
	</head>
	<body>
		<div layout:fragment="content">
			<div class="d-flex justify-content-between py-2 my-1 border-bottom">
				<div>
					<span class="h2">Product Index</span>
					<span class="align-top"><a id="btnAdd" class="btn btn-success rounded mx-1"><i class="fas fa-plus text-white"></i></a></span>
				</div>
				<div class="col-6">
					<form id="frmFilter">
						<div class="input-group">
							<input th:value="${filter}" name="filter" type="text" id="txtFilter" class="form-control" placeholder="Name, Variant or Category..." />
							<button type="submit" class="input-group-text"><i class="fas fa-filter" title="Filter by Name, Variant or Category..."></i></button>
						</div>
					</form>
				</div>
			</div>
			<div>
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							<th class="d-none d-sm-table-cell col-lg-1">Image</th>
							<th class="col-sm-1 col-lg-1">ID</th>
							<th class="col-sm-7 col-lg-2">Name</th>
							<th class="col-sm-2 col-lg-2">Price</th>
							<th class="d-none d-sm-table-cell col-lg-1">Stock</th>
							<th class="d-none d-sm-table-cell col-lg-2">Variant</th>
							<th class="d-none d-sm-table-cell col-lg-2">Category</th>
							<th class="col-sm-2 col-lg-2 text-center">Action</th>
						</tr>
					</thead>
					<tbody>
						<tr th:if="${!product.empty}" th:each="item:${product.content}">
							<td class="d-none d-sm-table-cell">
								<div class="rounded">
									<img class="img-fluid" th:if="${item.image != null}" th:src="${imgFolder + item.image}" />
								</div>
							</td>
							<td th:text="${item.id}">1</td>
							<td th:text="${item.name}">Bubur Ayam</td>
							<td th:text="${item.price}">9999</td>
							<td th:text="${item.stock}" class="d-none d-sm-table-cell">99</td>
							<td th:text="${item.variantName}" class="d-none d-sm-table-cell">Bubur</td>
							<td th:text="${item.categoryName}" class="d-none d-sm-table-cell">Bubur</td>
							<td>
								<div class="d-flex justify-content-center">
									<div class="btn-group align-mid">
										<button th:data-id="${item.id}" class="btn btn-info" title="Details..." href="/category/1"><i class="fas fa-list-alt"></i></button>
										<button th:data-id="${item.id}" class="btn btn-primary" title="Edit..."><i class="fas fa-edit"></i></button>
										<button th:data-id="${item.id}" class="btn btn-danger" title="Delete..."><i class="fas fa-trash"></i></button>
									</div>
								</div>
							</td>
						</tr>
						<tr th:if="${errorMsg != null}">
							<td colspan="8" class="text-danger text-center fst-italic" th:text="${errorMsg}">-- No Product data available! --</td>
						</tr>					
					</tbody>
					<tfoot>
						<tr>
							<td colspan="8">
								<div class="d-flex justify-content-between">
									<div class="w-auto input-group">
										<label class="input-group-text">Page Size</label>
										<select class="form-select" name="currPageSize" id="pageSize">
											<option th:each="i : ${#numbers.sequence(5,20,5)}" th:value="${i}" th:text="${i}" th:selected="${i == currPageSize}"></option>
										</select>
									</div>
									<div class="w-auto input-group">
										<button id="btnPrev" title="Previous Page..." class="btn btn-secondary"><i class="fas fa-backward"></i></button>
										<span class="input-group-text text-end" id="pagePosition" th:text="|Page ${product.number+1} of ${product.totalPages}|"></span>
										<button id="btnNext" title="Next Page..." class="btn btn-secondary"><i class="fas fa-forward"></i></button>
									</div>
									<div class="input-group" style="width: 10rem;">
										<input class="form-control text-end" type="text" th:value="${product.totalElements}" />
										<label class="input-group-text">Entries</label>
									</div>
								</div>
							</td>
						</tr>
					</tfoot>
				</table>
			</div>
			
			<script th:inline="javascript">
				let prodId;
				$(document).ready(function(e) {
					let isFistPage = /*[[${product.first}]]*/true;
					let isLastPage = /*[[${product.last}]]*/false;

					$( "#btnPrev" ).prop( "disabled", isFistPage );
					$( "#btnNext" ).prop( "disabled", isLastPage );
				});

				$("#btnAdd").click(function(e) {
					$("#staticModalBodyLg").load("/product/add");
					$("#staticModalLg").modal("show");
				});

				$(".btn-primary").click(function(e) {
					prodId = $(this).data("id");

					$("#staticModalBodyLg").load("/product/edit/" + prodId);
					$("#staticModalLg").modal("show");
				});

				$(".btn-danger").click(function(e) {
					prodId = $(this).data("id");

					$("#staticModalBody").load("/product/delete/" + prodId);
					$("#staticModal").modal("show");
				});

				$("#btnPrev").click(function(e){
					let filter = $("#txtFilter").val();
					let currPageSize = /*[[${currPageSize}]]*/0;
					let pageNumber = /*[[${product.number}]]*/0;

					location.href = `/product?filter=${filter}&pageNumber=${(pageNumber-1)}&currPageSize=${currPageSize}`;
				});


				$("#btnNext").click(function(e){
					let filter = $("#txtFilter").val();
					let currPageSize = /*[[${currPageSize}]]*/0;
					let pageNumber = /*[[${product.number}]]*/0;
					
					location.href = `/product?filter=${filter}&pageNumber=${(pageNumber+1)}&currPageSize=${currPageSize}`;
				});

				$("#pageSize").change(function(e) {
					let filter = $("#txtFilter").val();
					let currPageSize = $(this).val();
					let pageNumber = /*[[${product.number}]]*/0;

					location.href = `/product?filter=${filter}&pageNumber=${(pageNumber)}&currPageSize=${currPageSize}`;
				});
			</script>
		</div>
	</body>
</html>